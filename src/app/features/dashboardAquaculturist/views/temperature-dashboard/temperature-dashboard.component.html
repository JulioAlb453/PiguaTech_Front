<div class="dashboard">
  <main class="dashboard__content">
    <div class="dashboard__main">
      <header class="dashboard__header">
        <h1 class="dashboard__title">Temperatura del Agua</h1>
        <button
          class="dashboard__notification-bell"
          [class.dashboard__notification-bell--active]="hasNewNotifications"
          (click)="onBellClick()"
          aria-label="Ver notificaciones"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
            <path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z"></path>
          </svg>
        </button>
      </header>

      <nav class="dashboard__time-selector">
        <button
          class="dashboard__time-selector-button"
          [class.dashboard__time-selector-button--active]="selectedRange === TimeRange.Daily"
          (click)="onRangeChange(TimeRange.Daily)"
        >
          Diario
        </button>
        <button
          class="dashboard__time-selector-button"
          [class.dashboard__time-selector-button--active]="selectedRange === TimeRange.Weekly"
          (click)="onRangeChange(TimeRange.Weekly)"
        >
          Semanal
        </button>
        <button
          class="dashboard__time-selector-button"
          [class.dashboard__time-selector-button--active]="selectedRange === TimeRange.Monthly"
          (click)="onRangeChange(TimeRange.Monthly)"
        >
          Mensual
        </button>
      </nav>

      <section class="dashboard__trend">
        <h2 class="dashboard__trend-title">Monitoreo de Temperatura</h2>
        <div class="dashboard__trend-main">
          <p class="dashboard__trend-value">{{ displayValue }}춿C</p>
          <div class="dashboard__trend-summary">
            <div class="dashboard__summary-item">
              <span class="dashboard__summary-label dashboard__summary-label--limit-high">L칤mite M치x:</span>
              <span class="dashboard__summary-value">{{ averageHigh }}춿C</span>
            </div>
            <div class="dashboard__summary-item">
              <span class="dashboard__summary-label dashboard__summary-label--limit-low">L칤mite M칤n:</span>
              <span class="dashboard__summary-value">{{ averageLow }}춿C</span>
            </div>
          </div>
        </div>
      </section>

      <apx-chart
        #chart
        *ngIf="chartOptions"
        [series]="chartOptions.series"
        [chart]="chartOptions.chart"
        [xaxis]="chartOptions.xaxis"
        [yaxis]="chartOptions.yaxis"
        [tooltip]="chartOptions.tooltip"
        [stroke]="chartOptions.stroke"
        [grid]="chartOptions.grid"
        [dataLabels]="chartOptions.dataLabels"
        [legend]="chartOptions.legend"
        [colors]="chartOptions.colors"
      >
      </apx-chart>
    </div>

    <section class="dashboard__alerts">
      <h2 class="dashboard__alerts-title">Alertas</h2>
      <div class="dashboard__alert-control">
        <label class="dashboard__alert-label">Rango de Temperatura Configurado</label>
        <div class="dashboard__current-range">
          <span class="dashboard__range-item dashboard__range-item--high">M치x: {{ averageHigh }}춿C</span>
          <span class="dashboard__range-item dashboard__range-item--low">M칤n: {{ averageLow }}춿C</span>
        </div>
        <div class="dashboard__alert-buttons">
          <button class="dashboard__action-button dashboard__action-button--primary" (click)="openAlertModal()">
            Configurar Alertas
          </button>
        </div>
      </div>
    </section>
  </main>

  <div class="dashboard__modal-overlay" *ngIf="showAlertModal" (click)="closeAlertModal()">
    <div class="dashboard__modal" (click)="$event.stopPropagation()">
      <div class="dashboard__modal-header">
        <h3 class="dashboard__modal-title">Configurar Alertas de Temperatura</h3>
        <button class="dashboard__modal-close" (click)="closeAlertModal()" aria-label="Cerrar modal">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
            <path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path>
          </svg>
        </button>
      </div>
      <div class="dashboard__modal-body">
        <div class="dashboard__form-group">
          <label class="dashboard__form-label" for="alertHigh">Temperatura M치xima (춿C)</label>
          <input id="alertHigh" type="number" class="dashboard__form-input" [(ngModel)]="tempAlertHigh" min="0" max="50" step="0.1">
          <small class="dashboard__form-hint">Se activar치 una alerta cuando la temperatura supere este valor</small>
        </div>
        <div class="dashboard__form-group">
          <label class="dashboard__form-label" for="alertLow">Temperatura M칤nima (춿C)</label>
          <input id="alertLow" type="number" class="dashboard__form-input" [(ngModel)]="tempAlertLow" min="0" max="50" step="0.1">
          <small class="dashboard__form-hint">Se activar치 una alerta cuando la temperatura est칠 por debajo de este valor</small>
        </div>
        <div class="dashboard__range-preview">
          <h4 class="dashboard__preview-title">Vista Previa del Rango</h4>
          <div class="dashboard__preview-range">
            <span class="dashboard__preview-value dashboard__preview-value--low">{{ tempAlertLow }}춿C</span>
            <div class="dashboard__preview-bar">
              <div class="dashboard__preview-safe-zone"></div>
            </div>
            <span class="dashboard__preview-value dashboard__preview-value--high">{{ tempAlertHigh }}춿C</span>
          </div>
          <p class="dashboard__preview-text">Zona segura: {{ tempAlertLow }}춿C - {{ tempAlertHigh }}춿C</p>  
        </div>
      </div>
      <div class="dashboard__modal-footer">
        <button class="dashboard__modal-button dashboard__modal-button--secondary" (click)="closeAlertModal()">Cancelar</button>
        <button class="dashboard__modal-button dashboard__modal-button--primary" (click)="saveAlertSettings()" [disabled]="tempAlertHigh <= tempAlertLow">Guardar Configuraci칩n</button>
      </div>
    </div>
  </div>

  <div class="notification-modal__overlay" *ngIf="showNotificationModal" (click)="showNotificationModal = false">
    <div class="notification-modal" (click)="$event.stopPropagation()">
      <div class="notification-modal__header">
        <h3 class="notification-modal__title">Notificaciones Recientes</h3>
        <button class="notification-modal__close" (click)="showNotificationModal = false" aria-label="Cerrar modal">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>
        </button>
      </div>
      <div class="notification-modal__body">
        <ul class="notification-list" *ngIf="modalAlerts$ | async as alerts; else noNotifications">
          <ng-container *ngIf="alerts.length > 0; else noNotifications">
            <li class="notification-item" *ngFor="let alert of alerts" [ngClass]="'notification-item--' + alert.type">
              <span class="notification-item__icon">
                <ng-container *ngIf="alert.type === 'error'">游뚿</ng-container>
                <ng-container *ngIf="alert.type === 'warning'">游븱</ng-container>
              </span>
              <div class="notification-item__content">
                <p class="notification-item__message">{{ alert.title }}</p>
                <small class="notification-item__timestamp">{{ alert.timestamp | date:'medium' }}</small>
              </div>
            </li>
          </ng-container>
        </ul>
        <ng-template #noNotifications>
          <div class="notification-empty">
            <p>No hay notificaciones recientes.</p>
          </div>
        </ng-template>
      </div>
      <div class="notification-modal__footer">
        <a class="notification-modal__link" (click)="goToAlertsHistory()" href="javascript:void(0)">Ver Historial Completo</a>
      </div>
    </div>
  </div>
</div>