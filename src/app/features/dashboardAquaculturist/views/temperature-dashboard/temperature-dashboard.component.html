<div class="dashboard">
  <main class="dashboard__content">
    <div class="dashboard__main">
      <header class="dashboard__header">
        <h1 class="dashboard__title">Temperatura del Agua</h1>
        <button
          class="dashboard__notification-bell"
          aria-label="Ver notificaciones"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 256 256"
          >
            <path
              d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z"
            ></path>
          </svg>
        </button>
      </header>

      <nav class="dashboard__time-selector">
        <button
          class="dashboard__time-selector-button"
          [class.dashboard__time-selector-button--active]="
            selectedRange === TimeRange.Daily
          "
          (click)="onRangeChange(TimeRange.Daily)"
        >
          Diario
        </button>
        <button
          class="dashboard__time-selector-button"
          [class.dashboard__time-selector-button--active]="
            selectedRange === TimeRange.Weekly
          "
          (click)="onRangeChange(TimeRange.Weekly)"
        >
          Semanal
        </button>
        <button
          class="dashboard__time-selector-button"
          [class.dashboard__time-selector-button--active]="
            selectedRange === TimeRange.Monthly
          "
          (click)="onRangeChange(TimeRange.Monthly)"
        >
          Mensual
        </button>
      </nav>

      <section class="dashboard__trend">
        <h2 class="dashboard__trend-title">Monitoreo de Temperatura</h2>
        <div class="dashboard__trend-main">
          <p class="dashboard__trend-value">{{ displayValue }}°C</p>

          <div class="dashboard__trend-summary">
            <div class="dashboard__summary-item">
              <span
                class="dashboard__summary-label dashboard__summary-label--limit-high"
                >Límite Máx:</span
              >
              <span class="dashboard__summary-value">{{ averageHigh }}°C</span>
            </div>
            <div class="dashboard__summary-item">
              <span
                class="dashboard__summary-label dashboard__summary-label--limit-low"
                >Límite Mín:</span
              >
              <span class="dashboard__summary-value">{{ averageLow }}°C</span>
            </div>
          </div>
        </div>
      </section>

      <apx-chart
        #chart
        *ngIf="chartOptions"
        [series]="chartOptions.series"
        [chart]="chartOptions.chart"
        [xaxis]="chartOptions.xaxis"
        [yaxis]="chartOptions.yaxis"
        [tooltip]="chartOptions.tooltip"
        [stroke]="chartOptions.stroke"
        [grid]="chartOptions.grid"
        [dataLabels]="chartOptions.dataLabels"
        [legend]="chartOptions.legend"
        [colors]="chartOptions.colors"
      >
      </apx-chart>
    </div>

    <section class="dashboard__alerts">
      <h2 class="dashboard__alerts-title">Alertas</h2>
      <div class="dashboard__alert-control">
        <label class="dashboard__alert-label">
          Rango de Temperatura Configurado
        </label>
        
        <div class="dashboard__current-range">
          <span class="dashboard__range-item dashboard__range-item--high">
            Máx: {{ averageHigh }}°C
          </span>
          <span class="dashboard__range-item dashboard__range-item--low">
            Mín: {{ averageLow }}°C
          </span>
        </div>

        

        <div class="dashboard__alert-buttons">
          <button 
            class="dashboard__action-button dashboard__action-button--primary"
            (click)="openAlertModal()"
          >
            Configurar Alertas
          </button>
        </div>
      </div>
    </section>
  </main>

  <div 
    class="dashboard__modal-overlay" 
    *ngIf="showAlertModal"
    (click)="closeAlertModal()"
  >
    <div 
      class="dashboard__modal" 
      (click)="$event.stopPropagation()"
    >
      <div class="dashboard__modal-header">
        <h3 class="dashboard__modal-title">Configurar Alertas de Temperatura</h3>
        <button 
          class="dashboard__modal-close"
          (click)="closeAlertModal()"
          aria-label="Cerrar modal"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 256 256"
          >
            <path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path>
          </svg>
        </button>
      </div>

      <div class="dashboard__modal-body">
        <div class="dashboard__form-group">
          <label class="dashboard__form-label" for="alertHigh">
            Temperatura Máxima (°C)
          </label>
          <input
            id="alertHigh"
            type="number"
            class="dashboard__form-input"
            [(ngModel)]="tempAlertHigh"
            min="0"
            max="50"
            step="0.1"
          >
          <small class="dashboard__form-hint">
            Se activará una alerta cuando la temperatura supere este valor
          </small>
        </div>

        <div class="dashboard__form-group">
          <label class="dashboard__form-label" for="alertLow">
            Temperatura Mínima (°C)
          </label>
          <input
            id="alertLow"
            type="number"
            class="dashboard__form-input"
            [(ngModel)]="tempAlertLow"
            min="0"
            max="50"
            step="0.1"
          >
          <small class="dashboard__form-hint">
            Se activará una alerta cuando la temperatura esté por debajo de este valor
          </small>
        </div>

        <div class="dashboard__range-preview">
          <h4 class="dashboard__preview-title">Vista Previa del Rango</h4>
          <div class="dashboard__preview-range">
            <span class="dashboard__preview-value dashboard__preview-value--low">
              {{ tempAlertLow }}°C
            </span>
            <div class="dashboard__preview-bar">
              <div class="dashboard__preview-safe-zone"></div>
            </div>
            <span class="dashboard__preview-value dashboard__preview-value--high">
              {{ tempAlertHigh }}°C
            </span>
          </div>
          <p class="dashboard__preview-text">
            Zona segura: {{ tempAlertLow }}°C - {{ tempAlertHigh }}°C
          </p>  
        </div>
      </div>

      <div class="dashboard__modal-footer">
        <button 
          class="dashboard__modal-button dashboard__modal-button--secondary"
          (click)="closeAlertModal()"
        >
          Cancelar
        </button>
        <button 
          class="dashboard__modal-button dashboard__modal-button--primary"
          (click)="saveAlertSettings()"
          [disabled]="tempAlertHigh <= tempAlertLow"
        >
          Guardar Configuración
        </button>
      </div>
    </div>
  </div>
</div>